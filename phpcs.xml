<?xml version="1.0"?>
<ruleset name="Mobility Trailblazers Security">
    <description>WordPress Security Coding Standards for Mobility Trailblazers Plugin</description>

    <!-- Scan all PHP files in the plugin -->
    <file>.</file>
    
    <!-- Exclude vendor and node_modules directories -->
    <exclude-pattern>*/vendor/*</exclude-pattern>
    <exclude-pattern>*/node_modules/*</exclude-pattern>
    <exclude-pattern>*/.git/*</exclude-pattern>
    <exclude-pattern>*/tests/*</exclude-pattern>
    
    <!-- Include WordPress security rules -->
    <rule ref="WordPress-Security">
        <!-- Focus on critical security issues -->
        <severity>5</severity>
    </rule>

    <!-- Include WordPress Core rules for escaping and sanitization -->
    <rule ref="WordPress.Security.EscapeOutput">
        <properties>
            <property name="customEscapingFunctions" type="array">
                <element value="esc_html"/>
                <element value="esc_attr"/>
                <element value="esc_url"/>
                <element value="esc_js"/>
                <element value="wp_kses"/>
                <element value="wp_kses_post"/>
            </property>
        </properties>
    </rule>

    <rule ref="WordPress.Security.NonceVerification">
        <properties>
            <property name="customNonceVerificationFunctions" type="array">
                <element value="wp_verify_nonce"/>
                <element value="check_ajax_referer"/>
            </property>
        </properties>
    </rule>

    <rule ref="WordPress.Security.ValidatedSanitizedInput">
        <properties>
            <property name="customSanitizingFunctions" type="array">
                <element value="sanitize_text_field"/>
                <element value="sanitize_email"/>
                <element value="sanitize_title"/>
                <element value="sanitize_key"/>
                <element value="absint"/>
                <element value="intval"/>
            </property>
        </properties>
    </rule>

    <!-- SQL Injection prevention -->
    <rule ref="WordPress.DB.PreparedSQL"/>
    <rule ref="WordPress.DB.PreparedSQLPlaceholders"/>
    
    <!-- Check for direct file access -->
    <rule ref="WordPress.Security.PluginMenuSlug"/>
    
    <!-- Check for capabilities -->
    <rule ref="WordPress.WP.Capabilities"/>
    
    <!-- PHP compatibility -->
    <config name="testVersion" value="7.4-"/>
    <rule ref="PHPCompatibilityWP"/>
    
    <!-- Set minimum supported WordPress version -->
    <config name="minimum_supported_wp_version" value="5.8"/>
</ruleset>
